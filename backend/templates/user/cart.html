<script>
const token = localStorage.getItem("access");
if (!token) window.location.href = "/login/";
</script>

<nav>
  <a href="/products/">Products</a> |
  <a href="/cart/">Cart</a> |
  <a href="/orders/">Orders</a> |
  <a href="/login/" onclick="localStorage.clear()">Logout</a>
</nav>

<hr>

<h2>Cart</h2>
<ul id="cartList"></ul>
<button onclick="checkout()">Checkout</button>

<script>
function renderCart() {
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const cartList = document.getElementById("cartList");
  cartList.innerHTML = "";

  if (cart.length === 0) {
    cartList.innerHTML = "<li>Cart is empty</li>";
    return;
  }

  cart.forEach((item, index) => {
    cartList.innerHTML += `
      <li>
        Product ID: ${item.product_id} |
        Quantity: ${item.quantity}

        <button onclick="updateQty(${index}, 1)">+</button>
        <button onclick="updateQty(${index}, -1)">-</button>
        <button onclick="removeItem(${index})">Delete</button>
      </li>`;
  });
}

function updateQty(index, change) {
  let cart = JSON.parse(localStorage.getItem("cart"));
  cart[index].quantity += change;

  if (cart[index].quantity <= 0) {
    cart.splice(index, 1);
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function removeItem(index) {
  let cart = JSON.parse(localStorage.getItem("cart"));
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function checkout() {
  window.location.href = "/checkout/";
}

renderCart();
</script>
